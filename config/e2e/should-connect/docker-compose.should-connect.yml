version: '3.3'

networks:
  my_net:
    ipam:
      config:
        - subnet: 172.20.0.0/24

services:
  db1:
    image: "postgres:9.6.12"
    container_name: 'db1'
    restart: always
    expose: # only internal
      - '5432'
    environment:
     POSTGRES_PASSWORD: docker
     POSTGRES_DB: postgres
     POSTGRES_USER: postgres
    networks:
      my_net:
        ipv4_address: 172.20.0.2
  node1:
    build: ../../..
    container_name: 'node1'
    image: gny-experiment:integration # tags
    command: bash -c 'sleep 10s; node packages/main/dist/src/app'
    environment:
      - NODE_ENV=production
      - GNY_PUBLIC_IP=172.20.0.3
      - GNY_MONGO_LOGGING_DISABLE=true
      - GNY_DB_PASSWORD=docker
      - GNY_DB_DATABASE=postgres
      - GNY_DB_USER=postgres
      - GNY_DB_HOST=db1
      - GNY_DB_PORT=5432
      - GNY_P2P_SECRET="CAASqAkwggSkAgEAAoIBAQD2XwugW7RfQgEy4xD3CNStP7JvvwopbRloefLEEDkH+03KZ7htsU1ol1B+qdwIXppoX0J70UuUSvF7i+47/h5oyFroVme5QJeZ+kcik8lWETfn7dJ8U91Ilv1InI1+c4cHNARlAsdxwV4aoDBcroKmBoCESgDCYAK1DzPlpOImfXe6zrvTjIU3DaRgBMP91NOI8BMXRbuZeFe8f6RwyO7aTWJ+eiFdfwjAm3InNDB6KJhwOfS7W/YGZ4ZrkU9By1K8oywTg+0XQtQIu0ioh06ctuMv7y+pRCdeIE/NPkZ2wQNFPX4JRXKnT/eMPHkhJc7JTJkTblz7sIMMfIpwyl+rAgMBAAECggEBAJw6TQ8U194H5uaz4lAkQ2jRGX+O7wyx6Ai+O9lkSCXtj7in6OV2JxYJzbtkTujnxJYmwevuHjUdCOBFLX7Rd8sOMcde80sf0IKNmIoumN+A76icwHqiW5HqXRasX3UuIRPKQncjOgHCkr/jkIdVCffp65j3rF+VrmHOECSxV877RmpmslHqmeBw2BsV1fhAXT4tCKN2J6ngzA4ecs3LIVulXP5niBJJ0VqZUzo0U84qaVfHqBssf+tUmurcsAmWWbbqgDZN3stfvTR5Wdgp6AYIq6wxc7fNMmZS49/egikntnRWfAHoIhP4KvE/DnW7ps29sONSN2MZTS6MQoCVJXECgYEA/T2HL1p3hp1sCItKxZg7lo2MrJBapb3ueVEKIiaoCevRmoTBB+8K/gBFjTUMdZ6Ue5Hkq2dpLBjzrtmGgQ9vjOFFqLKh4YWpgraP3p0OIbd4OWNwUJuwS515XgoWr+cxIUlhX/SdSl4rEyvf9GLP/PXlk7vp4pKd7NgkNGmorucCgYEA+Q5awFlp4aqBY2FsPCHsC4BCWlbgkcLMAPKL0KTkLG7OOTk65rw3+KNd4PtS+TgdHZtEvb9/2Piykxxc3UM1xQLmNd4Xi3TT/rBEbzjmMe9OWT6V3Hhsp44bZJ5EDCVsxdT/EU1j5EDZ5NLT5wQtaAMNu6YgHTAvso3UYYeYhJ0CgYBszwYJy6Y1uegUV70932YjDxjVgITiWBRiHfbrq45iDOgXq1jBTu17K6S2wodi9ks4OPx2xU0EPIhfpWlMhNRaROTIUlCJ9QNbfZOdg//xbsKCbf5xNCPwqW3fgRg0ZnLOqZfkQddff8ykRSLJ/7b8Kq+E5aXdyz9953TO7GMlGwKBgE8pp+Dhyszm5E+RZNTMN3oEX5LVcHYEQ9G9RoGgF8KjybrYnQdAJk5Kpwle+SWsF10UwEnLt7hgfGpUJpRRy6J+ZGwU1skF7mhS4L21iT2wAehOA1ZblLXBbqWRxLFTp/pN1HFMdwbTMi8QcDhK1J/t8IyHpkeAzHhlqm8BqZHlAoGBAIkYeH/fC5T4oGPWj+vIz64lzvCPz9BHITpsMpGSd2GSQWPc7EcOqmUd/x+fp/2Bw7q63uMD+mmcbVeZVqz3GyE+xVwZLsxLwp0/kIiXBR3RoucTg0agBh6gtijD/pmZr/3aAIOXCClB02nzYtbUreJT5b6KCeDLPCaoqXTrg9Qp"
      - GNY_SECRET=carpet pudding topple genuine relax rally problem before pill gun nation method,camp skirt swarm fatal rose daughter forest original artwork mosquito finish patch,sadness increase opinion fire sense major panther carry exotic female shadow loop,erupt fun hope fashion snap liquid situate wing film bacon trade town,rely amateur embody convince oval slender quiz waste humble industry inquiry boss,bar light swap bring check blush later suggest broken egg wisdom rose,slight reason often exact chief fun fantasy blade speak expand enact cream,state myself swim early sorry cycle become hamster balance timber alter mail,matter arena slim weasel pond choice law spoon romance resource meat apart,trash drill neither cheap ten match pizza tobacco another air model trip,glory shock catch custom target explain lizard oval kitten dinner amazing invest,useful away answer web meadow purse diamond round damp leader matrix setup,split clown fatal enjoy umbrella radar immune medal hint sketch riot swing,tank physical spice illegal large paper guitar damp garbage camp cluster harsh,give focus cattle route priority rather cruise inmate satoshi region lesson shuffle,yellow badge raccoon you chest sorry album what brother oval inmate grape,glimpse slice venture use switch fix keep barely awesome cupboard image sail,vault horror kingdom elite mistake client miss casino better pole biology poem,egg sound lonely lava industry clever awkward wire acquire museum useless amazing,inside lyrics dad hurry egg section example dream correct month giraffe situate,upon pattern velvet love oppose bubble ocean kidney any sister confirm world,toe voyage prefer violin deny field dog hen spot deputy night deer,example affair jar unveil ignore firm olive final chimney shoe turkey eternal,pistol strategy swift scene board olympic carry bus pill help final alert,scout course good suspect cradle rural erase prevent wrestle hollow kitchen organ,describe attend story sure another rely ripple strike profit better earn run,dizzy possible game increase scout hub idle abstract tree cousin make figure,general brother genre guess educate worry giant submit donkey fashion used ripple,arch acquire hobby arrive month bone moral impose fame six sibling tragic,coral ribbon reward bench excuse goddess dinner cinnamon unable wage unit potato,skirt inject shield century distance saddle solar ghost believe fuel female lamp,brass stadium boy eternal idea holiday three record connect mass original flock,kingdom rather bitter risk month hood ahead joy emerge girl easily pelican,spin crouch asthma wish behind swear buyer athlete title share employ escape,panic legend level deer avocado replace beauty title sport hat grass fortune,evolve acquire save pond provide clever black outside tip just spin pistol,dog shoulder cement fossil mammal business essay beef rule hurdle month slot,ranch snake sock silly case cover biology idle eternal pull govern title,image trouble permit now high current dust gaze ozone forget surprise tattoo,canyon ticket help during paddle swallow pottery jar scrub case enemy brave,palm uncle output stereo notice one tower vessel split when glance beauty,evidence replace onion floor dismiss write turn immune captain hello panther give,skate harbor leaf syrup call dish title fancy young country utility captain,enact dish perfect usual sail demise easy foot large trigger acid pitch,kit world gas episode unfold fix reopen discover deal cream gospel index,juice gossip trust actress cool female city february scene pride cannon social,census you model essence suggest alter blur winner thunder latin bunker left,fog remember velvet remember license hurt run ball tissue powder guide universe,street annual maple ceiling eager adult injury review panic cluster cherry that,lake august amount walnut ivory carry mountain tiger kid alter adult era
    ports:
      - '4096:4096'
      - '4097:4097'
    depends_on:
      - db1
    networks:
      my_net:
        ipv4_address: 172.20.0.3

  db2:
    image: "postgres:9.6.12"
    container_name: 'db2'
    restart: always
    expose: # only internal
      - '5432'
    environment:
     POSTGRES_PASSWORD: docker
     POSTGRES_DB: postgres
     POSTGRES_USER: postgres
    networks:
      my_net:
        ipv4_address: 172.20.0.4
  node2:
    build: ../../..
    container_name: 'node2'
    image: gny-experiment:integration # tags
    command: bash -c 'sleep 10s; node packages/main/dist/src/app'
    environment:
      - NODE_ENV=production
      - GNY_PUBLIC_IP=172.20.0.5
      - GNY_P2P_PEERS=/ip4/172.20.0.3/tcp/4097/p2p/QmUhjJ2EF76PVcRxWcijf336T6cwYnXsrtqQ3nEy5jeAM8
      - GNY_MONGO_LOGGING_DISABLE=true
      - GNY_DB_PASSWORD=docker
      - GNY_DB_DATABASE=postgres
      - GNY_DB_USER=postgres
      - GNY_DB_HOST=db2
      - GNY_DB_PORT=5432
      - GNY_P2P_SECRET="CAASqQkwggSlAgEAAoIBAQDc0BVL82Vbm8uIpydTj7gaiNtTm4NgHmZQrdVLAell24KbBVR12QTlwyZf1CK8hkRv1hT6TYyHOW3vGJe3wUqFVoVY5kgl6Uz5S0cDWOQ+4EIFkzsNtf8WPqneUqTQ+x6nmLVRr5ql7vVBG9r3VPE1kkApSvTknSJ8PjFM20gciw3NCG4dmPH8sKWLNF7mxy2J9XvaDuMzd2Vz8LmHHlJfDaEJ0xkVUMdnOnA9PW/liK9m0HZuK+44EXQi2V1e4uAP2TJJM3jTbTYr7Nj6mH/lfVKJ4aAFo5Ls7x0RzdVXA3DLYg3bGop78d19ILpxxgfP7ZMl7g0lYmevzRRXX9KtAgMBAAECggEBALsaZrFQsJYLUU+ds6kOosV5Kb+SiqOrnq7GXXGNUSPJ+MU6ovKozYmS7rVMn5J3gw3wrR3bEDSU6R4sDILb+jU5tww5NPFK2rpymt2vONg+VjM7KlLX4CoNNwr3pEigQL1qnFl3Hudzr8VXwRbKlwj5v/w9U31T2KDGYifptxTW+yxeK3tiCSXt3ltIPnWA2J9mO0gvtTa8sh3auJwHp86aS7LnhRgPvNDPiX1TdV6e58/1QE0prN2YMZLS0ey5gb7N3cJ9/K7vxsDgeg3ZTEDqSgDmu0109b/OeiWAXAXGez4JYoJr063mpuQPQlMoLjNi9agSOn6+puKlfY4XogECgYEA/iU/FiMBhryg18wKxS11iwyh4eEYWSAijrF+16wlN6nO0s988OhVAGrOGzb4LhK6UtX8T/yZzIcebsczo2LrZQCn+O5SUX6n1NFjlNIXbWZvbxc8B8kOAQN7qGR2p+zhjIp6dqTLTQyIRwd99UDDXJmEFjsH4eMh80emynfivCECgYEA3myR7sXF2RP1TeqmaV3cT5CHF20HJa2I6LVLHEKRFghFKB3QUhwbc+45Dw9R8yGUaZbosODwLwuFU4dnOwJ/Pd/lXCrv6MdtfQKn03F98jwf2pT/MVwrown6UMsXQgn1CpGvxVS+LsSAYC26o4vL6isHgyxS+HPeN+GhHYI7pQ0CgYAjyQLVDyDL5AuR1z08/mWqqqCwuY1AH3I+PWfq3mZvLA3fSTACi/RMFr3mvxq7AhASUecxLBRL5Eq4tnvi6a7TjgAY4RXeO8NOCB3Jerupv964+cCOKBU8t0zWLS83/fbUXztXMWUe+EDIH5nwyqm3hDZBGxbFC8JgCxrFL5RRgQKBgQCQZ+KzJ/oUvs1zgdX68LJZgdcDUYjjYHBTzWhvd5RkvofPzNN0i8UTFmY7LdIhzPpjN1PpipDFqnAsU+uktzFPRa7OkR3jfp7KG9BEChogDAMOUdABBvtZxd+bVs/J01chPobk0ekLyg4i422aQufoJ3mgI0XXArsSgs2sr+HzfQKBgQCMgkdsiGR6J3F2taJnUeMp+w4zV/md1mtrd/zdhaeWJVjpn+lX6Dn0PzJziSbMzzSRwLkVmrDwyhmwgSRkFNKI6O6JbQJ7W3/JHi2a4t5/od9+mmuH98sz7P10frczqfApLl0cahMfNi0NFeRvXHxVnZFCpc1aQl2eAnhAbjm0bQ=="
      - GNY_SECRET=student worth gallery help patch park casino shuffle twelve ridge very rural,fatigue kiwi bind gain check level file lunar fun around dash bottom,action focus wrestle clinic hunt hero letter error tip unhappy turtle resource,chief pulse absorb matter glad banner mountain pizza same float then item,vague scorpion faint mistake weather wear above interest slow prosper foam scatter,waste grain material town thank garment limit adjust merry narrow tattoo assist,grief remember recycle ivory giggle damage say travel rotate again enrich witness,actress acoustic spice shiver parrot rule notice palm mom segment special stumble,debate sustain noise suggest road worry ring skirt near yellow banana omit,castle debris oven manage invite employ orbit border split divert leaf cliff,twice shy gap expose actor indicate final verify nephew legend height rug,hybrid stem dust various undo upon rent hundred update east blossom reason,frog version large narrow among awesome mad face habit secret elevator unfair,inspire engage impact great orbit right flock liquid elbow basic shrug toss,music actress sphere narrow chat convince muscle develop solve sing human punch,wet margin unit palm salad thank foster wool traffic near essay lazy,adjust artefact into bacon crisp depend history rubber carry guilt foil hawk,chase evidence seek excite laundry treat fire verb better outdoor jazz unknown,stay hint gallery earn pink craft stone entry illegal divide club slight,orchard chief like crucial lumber cluster almost tag arena venture tenant alter,portion route summer surround session dune supply cake romance peanut title guard,coffee soap admit plate parade curtain garage diary kiwi dish witness rather,spy tank all whale beach salt soon cloud violin erase brother report,foil february brother timber moon army depth snake toddler file burger pottery,photo chronic awesome cabbage pupil music erupt sound tourist upset sister inquiry,dawn edit hour october crouch middle wheel thunder tag hold crisp library,box staff muscle fox jacket asthma evoke can fortune student fiscal miss,behave soldier sustain bread couch novel nominee scissors mystery vehicle glow crater,whisper dutch tennis circle bag shell train bunker tornado fire future jazz,remove position ring winner ride barrel miss stool bone energy inhale slight,kick rhythm pulse fox fossil buyer extra december air club good work,urge pelican middle horror manual card lemon track fiscal dilemma ahead minimum,ugly jaguar arrive comic engage depart salon novel prize panel blind toddler,west list provide need purpose lizard mercy armed glory focus carbon heart,letter vintage install promote maze jeans spider grant learn mouse ocean shrug,supreme seek chat potato return ticket direct script industry senior grape relief,like question monitor online logic cook position click answer pole spice paddle,jeans staff emerge buyer gloom issue squeeze reopen dog critic foil nest,accuse plate tape mobile message stereo fossil nation stick start tray voice,immune sad flee brother better piano flock crane clap asset awkward edit,trap hub impulse easy trap arch gaze basket mail ticket ghost hotel,future infant purchase session unhappy van scorpion trash orchard urban regular draw,void across endless clever brisk bachelor minute lemon garbage dance brother head,hair mimic cycle elevator cube faith pioneer bless demise spawn evoke toward,jeans tip month captain student boat abuse acid fetch light bounce pause,devote idle runway heavy salmon cave orbit defy until horse uncle fitness,resemble illegal hockey muffin cupboard erosion under occur call fiber funny cattle,ramp song example kid color seek pear lab swallow donate input seminar,gather differ beef final spike cover galaxy close remind symptom husband one,journey belt jar october song grid mouse pact swear mystery meat mosquito,pioneer boil auction crystal mimic spike ranch laptop praise card outside misery
    ports:
      - '4098:4096'
      - '4099:4097'
    depends_on:
      - db2
    networks:
      my_net:
        ipv4_address: 172.20.0.5
